<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>h</title>
    <link rel="stylesheet" type="text/css" href="../styles/index.css" />
    <link rel="stylesheet" type="text/css" href="../styles/expandableitems.css" />
    <link rel="stylesheet" type="text/css" href="../styles/otherpages.css" />
    <link href="../styles/prism.css" rel="stylesheet" />
    <script src="../app.js" defer></script>
</head>

<body>
    <nav class="navbar">
        <div class="expandable">
            <div class="expandable__title-bar">
                <ion-icon class="expandable__icon" name="menu-outline"></ion-icon>
            </div>
            <div class="expandable__content-wrapper">
                <ul class="expandable__content">
                    <li class="list-items"><a href="../index.html">Home</a></li>
                    <li class="list-items"><a href="aboutresume.html">About [&] Resume</a></li>
                    <li class="list-items"><a href="contact.html">Contact</a></li>
                    <div class="internal-expandable">
                        <div class="internal-expandable__title-bar">
                            <span class="internal-expandable__title">Portfolio</span>
                            <ion-icon class="internal-expandable__icon" name="chevron-back"></ion-icon>
                        </div>
                        <div class="internal-expandable__content-wrapper">
                            <div class="internal-expandable__content">
                                <li class="portfolio_list-items"><a href="sss.html">Soul Sync City</a></li>
                                <li class="portfolio_list-items"><a href="attachmentissues.html">Attachment Issues</a>
                                </li>
                                <li class="portfolio_list-items"><a href="partycrashers.html">Party Crashers</a>
                                </li>
                                <li class="portfolio_list-items"><a href="otherprojects.html">Other Projects</a>
                                </li>
                                <li class="portfolio_list-items"><a href="art.html">Art Showcase</a></li>
                            </div>
                        </div>
                    </div>
                </ul>
            </div>
        </div>
    </nav>
    <div class="navspacer"></div>
    <section class="otherpages">
        <div class="section_title">
            <h1>Attachment Issues</h1>
            <div class="section-container">
                <div class="section-h-left">
                    <div class="video-container">
                        <video controls>
                            <source src="/videos/Attachment_Issues_Trailer.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
                <div class="section-h-right">
                    <ul class="section-divided-textlist">
                        <li>
                            <h3> Engine </h3>
                            <p>Unity</p>
                        </li>
                        <li>
                            <h3> Language </h3>
                            <p>C#</p>
                        </li>
                        <li>
                            <h3> Duration </h3>
                            <p>4 months</p>
                        </li>
                        <li>
                            <h3> Team Size </h3>
                            <p>5</p>
                        </li>
                        <li>
                            <h3> Role </h3>
                            <p>Producer/Proggrammer</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="responsibilities">
            <div class="section-divided-stack">
                <div class="section-container">
                    <h2>Responsibilities:</h2>
                </div>
                <div class="section-container">
                    <div class="textlist_bulletpoint">
                        <h4>Producer</h4>
                        <li>&emsp;trying to keep team on task</li>
                        <li>&emsp;Managing schedules of avaliblity to work</li>
                        <h4>Programmer</h4>
                        <li>&emsp;helped others as needed</li>
                        <h4>Art</h4>
                        <li>&emsp;also helped optimize some of the UV's of the meshes</li>
                        <li>&emsp;also dabbled in a little bit of VFX</li>
                    </div>
                </div>
            </div>
        </div>
        <div class="worked_on_details">
            <div class="section-divided-stack">
                <div class="section-container">
                    <h2>My Contributions:</h2>
                </div>

                <div class="section-container">
                    <li class="section-divided-equally">
                        <div class="image-container">
                            <img src="../styles/images/BGVE.gif">
                        </div>
                    </li>
                    <li class="section-divided-equally">
                        <div class="image-container">
                            <img src="../styles/images/RGVE.gif">
                        </div>
                    </li>
                    <li class="section-divided-equally">
                        <h3>Visual Feedback of Sight Detection</h3>
                        <p>
                            Made the players glow brighter as you look at the player for longer peroid of time
                        </p>
                    </li>
                </div>

                <div class="section-container">
                    <li class="section-divided-equally">
                        <div class="image-container">
                            <img src="../styles/images/Reflection.gif">
                        </div>
                    </li>
                    <li class="section-divided-equally">
                        <h3>Visual Effect Reflection</h3>
                        <p>
                            had to deal with setting up reflectionProbe on this object so it can properly do reflections
                        </p>
                    </li>
                </div>

                <div class="section-container">
                    <li class="section-divided-equally">
                        <div class="image-container">
                            <img src="../styles/images/RGParticle.gif">
                        </div>
                    </li>
                    <li class="section-divided-equally">
                        <h3>Player Particles</h3>
                        <p>
                            to do this I had to learn some basics of the VFX graph so the particles would spawn on different points of the players mesh
                        </p>
                    </li>
                </div>

                <div class="section-container">
                    <li class="code_container">
                        <h3>Sight Detection Code</h3>
                        <pre>
                            <script src="../prism.js"></script>
<code class = "language-csharp line-numbers">using System.Collections;
using System.Collections.Generic;
using UnityEngine;
public class PlayerBehavior : MonoBehaviour
{
    #region Variables
    #region playerComponents
    [Tooltip("Other Player Script")]
    public PlayerBehavior otherPlayer;

    [Tooltip("Players Camera Component")]
    public Camera cam;

    private CapsuleCollider coll;
    #endregion
    #region RaycastStuff

    [Tooltip("Vector 3 Holding if the player has seen a specified object")]
    public Vector3 testSeen;

    [Tooltip("If the current player is looking at other player")]
    public static bool isLooking;


    [Tooltip("")]
    public bool teleportToCrane;

    private RaycastHit hit;
    #endregion

    #region Mirror stuff
    [Tooltip("Layer of the mirror")]
    public LayerMask layer;

    Plane[] calPlanes;

    /// &lt;summary&gt;
    /// All the mirrors that are in the current scene
    /// &lt;/summary&gt;
    private List &lt;MirrorBehavior&gt; mirrorsInScene = new List&lt;MirrorBehavior&gt;();

    /// &lt;summary&gt;
    /// refrence to current plane that has been hit of mirror behaviour
    /// &lt;/summary&gt;
    private GameObject plane;

    /// &lt;summary&gt;
    /// refrence to MirrorBehaviour script that has been contains the plane that has been hit
    /// &lt;/summary&gt;
    private MirrorBehavior mb;
    #endregion
    #endregion

    void FixedUpdate()
    {
        if (!GameController.isDead)
        {
            if (cam.gameObject.activeInHierarchy)
            {
            
                /* Movement Code Ommited Here */
            
                IsAnyMirror(out plane, out mb);
            
                Vector3 h = RaycastToObj(otherPlayer.meshR.gameObject, "Player");
                if(h == Vector3.zero)
                    h = RaycastToObj(otherPlayer.cam.gameObject, "Player");
            
                if (h != Vector3.zero)
                {
                    isLooking = true;
                    Ambient();
                }
                else if (h == Vector3.zero && isLooking)
                {
                    isLooking = false;
                    Ambient();
                }
            
            }
        }
    }

    /// &lt;summary&gt;
    /// Raycasts to object
    /// &lt;/summary&gt;
    /// &lt;param name="raycastedObj"&gt;object being raycasted&lt;obj raycasted /param&gt;
    /// &lt;returns&gt;Look rotation&lt;/returns&gt;
    public Vector3 RaycastToObj(GameObject raycastedObj, string Tag = "")
    {
        if (cam.gameObject.activeInHierarchy)
        {
            if (Physics.Raycast(cam.transform.position, (raycastedObj.transform.position - cam.transform.position).normalized,
            out hit, Mathf.Infinity, ~layer) && CheckIsVisible(cam, raycastedObj))
            {
                if (hit.collider.gameObject == raycastedObj || tag != "" && hit.collider.gameObject.CompareTag(tag))
                {
                    Debug.DrawLine(cam.transform.position, hit.point, Color.red);
                    return (raycastedObj.transform.position - cam.transform.position).normalized;
                }
                else
                {
                    Debug.DrawLine(cam.transform.position, hit.point, Color.blue);
                }
            }
            else if (mb != null && raycastedObj != plane)
            {
                Vector3 dir = RaycastToObj(plane);
            
                if (dir != Vector3.zero)
                {
                    if (mb.MirrorStuff(this, otherPlayer, dir, plane))
                        return dir;
                }
            
            }
        }
        return Vector3.zero;
    }

    /// &lt;summary&gt;
    /// Checks all mirrors in scene and if any of the planes are visible on that mirror then quits
    /// otherwise the inputs will be set to null
    /// &lt;/summary&gt;
    /// &lt;param name="plane"&gt; Plane that is seen from&lt;/param&gt;
    /// &lt;param name="mb"&gt; Script parent holding info to plane&lt;/param&gt;
    public void IsAnyMirror(out GameObject plane, out MirrorBehavior mb)
    {
        foreach (MirrorBehavior h in mirrorsInScene)
        {
            mb = h;
            foreach (GameObject g in h.planes)
            {
                plane = g;
                if (!IsVisible(g) && RaycastToObj(g) == Vector3.zero)
                {
                    h.Disable();
                }
                if (IsVisible(g) && RaycastToObj(g) != Vector3.zero)
                {
                    h.Enable();
                    return;
                }
            }
        }
        plane = null;
        mb = null;
    }

    /// &lt;summary&gt;
    /// If both the x and y coordinate of the returned point is between 0 and 1 (and the z coordinate is positive)
    /// then the point is seen by the camera aka returns true
    /// &lt;/summary&gt;
    /// &lt;param name="obj"&gt;Gameobject that checked if it is visible&lt;/param&gt;
    /// &lt;returns&gt;if obj is seen&lt;/returns&gt;
    public bool IsVisible(GameObject obj)
    {
        testSeen = cam.WorldToViewportPoint(obj.transform.position);
    
        if (testSeen.x &gt;= -.02 && testSeen.x &lt;= 1.05)
        {
            if (testSeen.y &gt;= -.2 && testSeen.y &lt;= 1)
            {
                if (testSeen.z &gt;= 0)
                {
                    return true;
                }
            }
        }
        return false;
    }

    private bool CheckIsVisible(Camera c, GameObject target)
    {
        var planes = GeometryUtility.CalculateFrustumPlanes(c);
        var point = target.transform.position;
    
        foreach (var plane in planes)
        {
            if (plane.GetDistanceToPoint(point) &lt; 0)
            {
                return false;
            }
        
        }
        return true;
    }
}
</code>
                        </pre>
                    </li>
                </div>

                <div class="section-container">
                    <li class="code_container">
                        <h3>Sight Detection With "Mirrors"</h3>
                        <p></p>
                        <pre>
                            <script src="../prism.js"></script>
<code class = "language-csharp line-numbers">using System.Collections;
using System.Collections.Generic;
using UnityEngine
public class MirrorBehavior : MonoBehaviour
{
    public GameObject camObj;
    private Camera cam;
    public GameObject[] planes = new GameObject[2];
    public PlayerBehavior p1;
    public PlayerBehavior p2;
    private RaycastHit hit;
    public GameObject reflectionProbe
    Plane[] calPlanes
    public bool isSeen
    private void Awake()
    {
        cam = camObj.GetComponent&lt;Camera&gt;();
    }

    private void SetCamFov(PlayerBehavior player, GameObject plane)
    {
        float t = Vector3.Distance(player.transform.position, plane.transform.position);
        cam.fieldOfView = 60 * Mathf.Pow(Mathf.Exp(1), -0.077f * t);
        /*
         * ^ IMPORTANT CAN BE MORE PRECISE
        */
    }

    /// &lt;summary&gt;
    /// If both the x and y coordinate of the returned point is between 0 and 1 (and the z coordinate is positive)
    /// then the point is seen by the camera aka returns true
    /// &lt;/summary&gt;
    /// &lt;param name="obj"&gt;Gameobject that checked if it is visible&lt;/param&gt;
    /// &lt;returns&gt;if obj is seen&lt;/returns&gt;
    public bool IsVisible(GameObject obj)
    {
        Vector3 testSeen = cam.WorldToViewportPoint(obj.transform.position);
    
        if (testSeen.x &gt;= -.1 && testSeen.x &lt;= 1)
        {
            if (testSeen.y &gt;= -.1 && testSeen.y &lt;= 1)
            {
                if (testSeen.z &gt;= 0)
                {
                    return true;
                }
            }
        }
        return false;
    }

    /// &lt;summary&gt;
    /// 
    /// &lt;/summary&gt;
    /// &lt;param name="curP"&gt;Current Active Player&lt;/param&gt;
    /// &lt;param name="othrP"&gt; Other Inactive Player&lt;/param&gt;
    /// &lt;param name="dir"&gt;Direction of the player looking at mirror&lt;/param&gt;
    public bool MirrorStuff(PlayerBehavior curP, PlayerBehavior othrP, Vector3 dir, GameObject plane)
    {
        if (dir != Vector3.zero)
        {
            Vector3 h = Vector3.Reflect(dir, plane.transform.up);
        
            Debug.DrawRay(transform.position, h, Color.green);
        
            camObj.transform.rotation = Quaternion.LookRotation(h);
        
            SetCamFov(curP, plane);
        
            if (GeometryUtility.TestPlanesAABB(calPlanes, curP.p_Renderer.bounds))
            {
                print(othrP.name + " is detected");
            }
        
            calPlanes = GeometryUtility.CalculateFrustumPlanes(cam);
        
            if (GeometryUtility.TestPlanesAABB(calPlanes, curP.p_Renderer.bounds) &&
                Physics.Raycast(cam.transform.position, 
                (curP.othrP.cam.transform.position - cam.transform.position).normalized,
                out hit, Mathf.Infinity, ~curP.layer))
            {
                Debug.DrawLine(cam.transform.position, hit.point, Color.blue);
                if (hit.collider.gameObject.Equals(othrP.gameObject))
                {
                    return true;
                }
            }
        }
        return false;
    
    }

    public void Enable()
    {
        cam.gameObject.SetActive(true);
        reflectionProbe.SetActive(true);
    }

    public void Disable()
    {
        cam.gameObject.SetActive(false);
        reflectionProbe.SetActive(false);
    }
}
</code>
                        </pre>
                    </li>
                </div>
            </div>


        </div>
        <div class="download_link">
            <div class="section-divided-stack">
                <div class="section-container">
                    <div class="clickable-button">
                        <a href="https://strongdark.itch.io/attachment-issues">Download on itch.io</a>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>

</html>